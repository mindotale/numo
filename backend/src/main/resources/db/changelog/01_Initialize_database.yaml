databaseChangeLog:
  - changeSet:
      id: 01_Initialize_database
      author: Numo
      changes:
        - sql:
            sql: |
              CREATE TABLE users (
                id                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                name               VARCHAR(255)                            NOT NULL,
                location           VARCHAR(255)                            NOT NULL,
                phone              VARCHAR(255)                            NOT NULL,
                birth_date         date                                    NOT NULL,
                source             VARCHAR(255),
                last_activity_date date                                    NOT NULL,
                CONSTRAINT pk_users PRIMARY KEY (id)
              );

        - sql:
            sql: |
              CREATE TABLE children (
                id         BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                name       VARCHAR(255)                            NOT NULL,
                birth_date date                                    NOT NULL,
                parent_id  BIGINT,
                CONSTRAINT pk_children PRIMARY KEY (id)
              );
              
              ALTER TABLE children
              ADD CONSTRAINT FK_CHILDREN_ON_PARENT FOREIGN KEY (parent_id) REFERENCES users (id);
              
              CREATE INDEX idx_child_parent_id ON children (parent_id);

        - sql:
            sql: |
              CREATE TABLE user_groups (
                id              BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
                name            VARCHAR(255)                            NOT NULL,
                min_age         INTEGER,
                max_age         INTEGER,
                min_child_count INTEGER,
                max_child_count INTEGER,
                locations       JSONB                                   NOT NULL,
                sources         JSONB                                   NOT NULL,
                CONSTRAINT pk_user_groups PRIMARY KEY (id)
              );
